/* -----------------------
   高级评分函数（智能容错）
-------------------------- */
function normalize(text) {
    return text
        .toString()
        .trim()
        .toLowerCase()
        .replace(/[\$]/g, "")          // 去掉货币符号
        .replace(/(\d+)(th|st|nd|rd)/g, "$1")  // 去掉日期序号
        .replace(/\s+/g, " ");         // 规范空格
}

function submitAnswers() {
    let score = 0;

    sectionData.questions.forEach((q) => {
        let user = "";

        if (q.type === "blank") {
            user = document.getElementById(`q${q.number}`).value || "";
        }

        if (q.type === "mcq") {
            let chosen = document.querySelector(`input[name="q${q.number}"]:checked`);
            if (chosen) user = chosen.value || "";
        }

        const userN = normalize(user);
        const ansN = normalize(q.answer);

        if (userN === ansN) score++;
    });

    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = `
        <strong>Your Score: ${score} / ${sectionData.questions.length}</strong><br><br>
        Thank you for completing Section ${sec}.
    `;
}
